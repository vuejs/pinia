# –ü–ª–∞–≥–∏–Ω—ã

–•—Ä–∞–Ω–∏–ª–∏—â–∞ Pinia –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞—Å—à–∏—Ä–µ–Ω—ã –±–ª–∞–≥–æ–¥–∞—Ä—è API –Ω–∏–∑–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è. –í–æ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≥–æ, —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å:

-   –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º
-   –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –æ–ø—Ü–∏–∏ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â
-   –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º
-   –û–±–µ—Ä–Ω—É—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã
-   –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –∏ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
-   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å side effects, —Ç–∞–∫–∏–µ –∫–∞–∫ [Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage)
-   –ü—Ä–∏–º–µ–Ω—è—Ç—å **—Ç–æ–ª—å–∫–æ** –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º

–ü–ª–∞–≥–∏–Ω—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ —ç–∫–∑–µ–º–ø–ª—è—Ä—É pinia —Å –ø–æ–º–æ—â—å—é `pinia.use()`. –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –ø—Ä–∏–º–µ—Ä - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –∫–æ –≤—Å–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º –ø—É—Ç–µ–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ–±—ä–µ–∫—Ç–∞:

```js
import { createPinia } from 'pinia'

// –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π—Å—Ç–≤–æ `secret` –≤ –∫–∞–∂–¥–æ–µ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
// –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –¥—Ä—É–≥–æ–º —Ñ–∞–π–ª–µ
function SecretPiniaPlugin() {
    return { secret: 'the cake is a lie' }
}

const pinia = createPinia()
// –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω—É pinia
pinia.use(SecretPiniaPlugin)

// –≤ –¥—Ä—É–≥–æ–º —Ñ–∞–π–ª–µ
const store = useStore()
store.secret // 'the cake is a lie'
```

–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä, –º–æ–¥–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ—Å—Ç–æ–≤.

## –í–≤–µ–¥–µ–Ω–∏–µ

–ü–ª–∞–≥–∏–Ω Pinia - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ –∂–µ–ª–∞–Ω–∏—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –û–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–¥–∏–Ω –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç, _context_:

```js
export function myPiniaPlugin(context) {
    context.pinia // pinia, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Å –ø–æ–º–æ—â—å—é `createPinia()`.
    context.app // —Ç–µ–∫—É—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ —Å –ø–æ–º–æ—â—å—é `createApp()` (—Ç–æ–ª—å–∫–æ –¥–ª—è Vue 3)
    context.store // —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –ø–ª–∞–≥–∏–Ω
    context.options // –æ–±—ä–µ–∫—Ç –æ–ø—Ü–∏–π, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π —Ö—Ä–∞–Ω–∏–ª–∏–∑–µ, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –≤ `defineStore()`.
    // ...
}
```

–ó–∞—Ç–µ–º —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `pinia` —Å –ø–æ–º–æ—â—å—é `pinia.use()`:

```js
pinia.use(myPiniaPlugin)
```

–ü–ª–∞–≥–∏–Ω—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º, —Å–æ–∑–¥–∞–Ω–Ω—ã–º **–ø–æ—Å–ª–µ —Å–∞–º–∏—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ –∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–¥–∞—á–∏ `pinia` –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**, –∏–Ω–∞—á–µ –æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.

## –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ –≤ –∫–∞–∂–¥–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—è –∏—Ö –æ–±—ä–µ–∫—Ç –≤ –ø–ª–∞–≥–∏–Ω–µ:

```js
pinia.use(() => ({ hello: 'world' }))
```

–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ `store`, –Ω–æ **–ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—É—é –≤–µ—Ä—Å–∏—é, —á—Ç–æ–±—ã –æ–Ω–∏ –º–æ–≥–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å—Å—è devtools**:

```js
pinia.use(({ store }) => {
    store.hello = 'world'
})
```

Any property _returned_ by a plugin will be automatically tracked by devtools so in order to make `hello` visible in devtools, make sure to add it to `store._customProperties` **in dev mode only** if you want to debug it in devtools:

```js
// –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤—ã—à–µ
pinia.use(({ store }) => {
    store.hello = 'world'
    // —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –±–∞–Ω–¥–ª–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ. Webpack –∏ vite –¥–æ–ª–∂–Ω—ã –¥–µ–ª–∞—Ç—å —ç—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    if (process.env.NODE_ENV === 'development') {
        // –¥–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        store._customProperties.add('hello')
    }
})
```

Note that every store is wrapped with [`reactive`](https://v3.vuejs.org/api/basic-reactivity.html#reactive), automatically unwrapping any Ref (`ref()`, `computed()`, ...) it contains:

```js
const sharedRef = ref('shared')
pinia.use(({ store }) => {
    // –∫–∞–∂–¥–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–º–µ–µ—Ç —Å–≤–æ–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ `hello`.
    store.hello = ref('secret')
    // –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è
    store.hello // 'secret'

    // –≤—Å–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–æ–≤–º–µ—Å—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–≤–æ–π—Å—Ç–≤–æ `shared`.
    store.shared = sharedRef
    store.shared // 'shared'
})
```

–í–æ—Ç –ø–æ—á–µ–º—É –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –≤—ã—á–∏—Å–ª—è–µ–º—ã–º —Å–≤–æ–π—Å—Ç–≤–∞–º –±–µ–∑ `.value` –∏ –ø–æ—á–µ–º—É –æ–Ω–∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã.

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–ª–∏ —Å–≤–æ–π—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏, **–≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö**:

-   –í `store`, —á—Ç–æ–±—ã –≤—ã –º–æ–≥–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –∫ –Ω–µ–º—É –¥–æ—Å—Ç—É–ø —Å –ø–æ–º–æ—â—å—é `store.myState`.
-   –í `store.$state`, —á—Ç–æ–±—ã –µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ devtools –∏ **—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–æ –≤—Ä–µ–º—è SSR**.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤–∞–º, –∫–æ–Ω–µ—á–Ω–æ –∂–µ, –ø—Ä–∏–¥–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ref()` (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π API), —á—Ç–æ–±—ã —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –¥–æ—Å—Ç—É–ø–∞–º–∏:

```js
import { toRef, ref } from 'vue'

pinia.use(({ store }) => {
    // —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å SSR, –Ω–∞–º –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º—ã –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º
    // —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    if (!Object.prototype.hasOwnProperty(store.$state, 'hasError')) {
        // hasError –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –ø–ª–∞–≥–∏–Ω–∞, –ø–æ—ç—Ç–æ–º—É –∫–∞–∂–¥–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–º–µ–µ—Ç —Å–≤–æ–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ
        // —Å–≤–æ–π—Å—Ç–≤–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        const hasError = ref(false)
        // —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–∞ `$state`, –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –µ–µ –≤–æ –≤—Ä–µ–º—è SSR
        store.$state.hasError = hasError
    }
    // –Ω–∞–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å—Å—ã–ª–∫—É –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º.
    // –æ–±–∞ –¥–æ—Å—Ç—É–ø–∞: store.hasError –∏ store.$state.hasError –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
    // –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    // –°–º. https://vuejs.org/api/reactivity-utilities.html#toref
    store.hasError = toRef(store.$state, 'hasError')

    // –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ª—É—á—à–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `hasError`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω
    // –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ `state` –≤ devtools
    // –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ, –∏ –µ—Å–ª–∏ –º—ã –≤–µ—Ä–Ω–µ–º –µ–≥–æ, devtools –æ—Ç–æ–±—Ä–∞–∑–∏—Ç –µ–≥–æ –¥–≤–∞–∂–¥—ã.
})
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤–Ω—É—Ç—Ä–∏ –ø–ª–∞–≥–∏–Ω–∞ (—á—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –≤—ã–∑–æ–≤ `store.$patch()`), –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º, –∏ –ø–æ—ç—Ç–æ–º—É **–Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –Ω–∏–∫–∞–∫–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫**.

:::warning
–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **Vue 2**, –Ω–∞ Pinia —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è [—Ç–µ –∂–µ –ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è –æ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏](https://v2.vuejs.org/v2/guide/reactivity.html#Change-Detection-Caveats), —á—Ç–æ –∏ –Ω–∞ Vue. –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Vue.set()` (Vue 2.7) –∏–ª–∏ `set()` (–∏–∑ `@vue/composition-api` –¥–ª—è Vue <2.7) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è, —Ç–∞–∫–∏—Ö –∫–∞–∫ `secret` –∏ `hasError`:

```js
import { set, toRef } from '@vue/composition-api'
pinia.use(({ store }) => {
    if (!Object.prototype.hasOwnProperty(store.$state, 'hello')) {
        const secretRef = ref('secret')
        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–æ –≤—Ä–µ–º—è SSR, –≤–∞–º —Å–ª–µ–¥—É–µ—Ç
        // —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –≤ —Å–≤–æ–π—Å—Ç–≤–µ `$state`, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω –∏
        // –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏
        set(store.$state, 'secret', secretRef)
    }
    // —Ç–∞–∫–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —á—Ç–æ–±—ã –≤—ã –º–æ–≥–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –∫ –Ω–µ–º—É –¥–æ—Å—Ç—É–ø
    // –æ–±–æ–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏: `store.$state.secret` / `store.secret`.
    set(store, 'secret', toRef(store.$state, 'secret'))
    store.secret // 'secret'
})
```

:::

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å–≤–æ–π—Å—Ç–≤

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–≤–æ–π—Å—Ç–≤, —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –∫–ª–∞—Å—Å–æ–≤, –ø—Ä–∏—à–µ–¥—à–∏—Ö –∏–∑ –¥—Ä—É–≥–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏, –≤—ã –¥–æ–ª–∂–Ω—ã –æ–±–µ—Ä–Ω—É—Ç—å –æ–±—ä–µ–∫—Ç —Å `markRaw()` –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –µ–≥–æ pinia. –í–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞ –≤ –∫–∞–∂–¥–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:

```js
import { markRaw } from 'vue'
// –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–∞—à –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä
import { router } from './router'

pinia.use(({ store }) => {
    store.router = markRaw(router)
})
```

## –í—ã–∑–æ–≤ `$subscribe` –≤–Ω—É—Ç—Ä–∏ –ø–ª–∞–≥–∏–Ω–æ–≤

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [store.$subscribe](./state.md#subscribing-to-the-state) –∏ [store.$onAction](./actions.md#subscribing-to-actions) –≤–Ω—É—Ç—Ä–∏ –ø–ª–∞–≥–∏–Ω–æ–≤:

```ts
pinia.use(({ store }) => {
    store.$subscribe(() => {
        // —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    })
    store.$onAction(() => {
        // —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —ç–∫—à–µ–Ω —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    })
})
```

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–ø—Ü–∏–π

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –æ–ø—Ü–∏–∏ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â, —á—Ç–æ–±—ã –≤–ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –∏–∑ –ø–ª–∞–≥–∏–Ω–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –æ–ø—Ü–∏—é `debounce`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∞–º –æ—Ç–º–µ–Ω–∏—Ç—å –ª—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ:

```js
defineStore('search', {
    actions: {
        searchContacts() {
            // ...
        },
    },

    // —ç—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –ø–ª–∞–≥–∏–Ω–æ–º –ø–æ–∑–∂–µ
    debounce: {
        // –æ—Ç–ª–æ–∂–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ searchContacts –Ω–∞ 300 –º—Å
        searchContacts: 300,
    },
})
```

–ó–∞—Ç–µ–º –ø–ª–∞–≥–∏–Ω –º–æ–∂–µ—Ç —Å—á–∏—Ç–∞—Ç—å —ç—Ç—É –æ–ø—Ü–∏—é –¥–ª—è –æ–±–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∏ –∑–∞–º–µ–Ω–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

```js
// –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É debounce
import debounce from 'lodash/debounce'

pinia.use(({ options, store }) => {
    if (options.debounce) {
        // –º—ã –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–∫—à–µ–Ω –Ω–æ–≤—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
        return Object.keys(options.debounce).reduce(
            (debouncedActions, action) => {
                debouncedActions[action] = debounce(
                    store[action],
                    options.debounce[action]
                )
                return debouncedActions
            },
            {}
        )
    }
})
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ 3-–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ setup:

```js
defineStore(
    'search',
    () => {
        // ...
    },
    {
        // —ç—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –ø–ª–∞–≥–∏–Ω–æ–º –ø–æ–∑–∂–µ
        debounce: {
            // debounce –¥–µ–π—Å—Ç–≤–∏–µ SearchContacts –Ω–∞ 300 –º—Å
            searchContacts: 300,
        },
    }
)
```

## TypeScript

–í—Å–µ, —á—Ç–æ –ø–æ–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ, –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏, –ø–æ—ç—Ç–æ–º—É –≤–∞–º –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `any` –∏–ª–∏ `@ts-ignore`.

### –¢–∏–ø–∏–∑–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤

–ü–ª–∞–≥–∏–Ω Pinia –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```ts
import { PiniaPluginContext } from 'pinia'

export function myPiniaPlugin(context: PiniaPluginContext) {
    // ...
}
```

### –í–≤–æ–¥ –Ω–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –≤—ã —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—à–∏—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `PiniaCustomProperties`.

```ts
import 'pinia'
import type { Router } from 'vue-router'

declare module 'pinia' {
    export interface PiniaCustomProperties {
        // –∏—Å–ø–æ–ª—å–∑—É—è —Å–µ—Ç—Ç–µ—Ä, –º—ã –º–æ–∂–µ–º —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏, —Ç–∞–∫ –∏ —Ä–µ—Ñ—ã
        set hello(value: string | Ref<string>)
        get hello(): string

        // –≤—ã –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        simpleNumber: number

        // –≤–≤–µ–¥–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –ø–ª–∞–≥–∏–Ω–æ–º –≤—ã—à–µ (#adding-new-external-properties)
        router: Router
    }
}
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –µ–≥–æ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å:

```ts
pinia.use(({ store }) => {
    store.hello = 'Hola'
    store.hello = ref('Hola')

    store.simpleNumber = Math.random()
    // @ts-expect-error: –º—ã –Ω–µ –Ω–∞–ø–µ—á–∞—Ç–∞–ª–∏ —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
    store.simpleNumber = ref(Math.random())
})
```

`PiniaCustomProperties` - —ç—Ç–æ –æ–±—â–∏–π —Ç–∏–ø, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Å–≤–æ–π—Å—Ç–≤–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–º–µ—Ä, –≥–¥–µ –º—ã –∫–æ–ø–∏—Ä—É–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –≤ `$options` (—ç—Ç–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â –æ–ø—Ü–∏–π):

```ts
pinia.use(({ options }) => ({ $options: options }))
```

–ú—ã –º–æ–∂–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ø–µ—á–∞—Ç–∞—Ç—å —ç—Ç–æ, –∏—Å–ø–æ–ª—å–∑—É—è 4 –æ–±—â–∏—Ö —Ç–∏–ø–∞ `PiniaCustomProperties`:

```ts
import 'pinia'

declare module 'pinia' {
    export interface PiniaCustomProperties<Id, S, G, A> {
        $options: {
            id: Id
            state?: () => S
            getters?: G
            actions?: A
        }
    }
}
```

:::tip
–ü—Ä–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ —Ç–∏–ø–æ–≤ –≤ generics, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞–∑–≤–∞–Ω—ã **—Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ**. `Id` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–∑–≤–∞–Ω `id` –∏–ª–∏ `I`, –∞ `S` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–∑–≤–∞–Ω `State`. –í–æ—Ç —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∫–∞–∂–¥–∞—è –±—É–∫–≤–∞:

-   S: –°–æ—Å—Ç–æ—è–Ω–∏–µ
-   G: –ì–µ—Ç—Ç–µ—Ä—ã
-   A: –≠–∫—à–µ–Ω—ã
-   SS: Setup Store / Store

:::

### –¢–∏–ø–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∫–∞–∫ –≤ `store`, —Ç–∞–∫ –∏ –≤ `store.$state`), –≤–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø –≤ `PiniaCustomStateProperties`. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `PiniaCustomProperties`, –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–∏–ø `State`:

```ts
import 'pinia'

declare module 'pinia' {
    export interface PiniaCustomStateProperties<S> {
        hello: string
    }
}
```

### –¢–∏–ø–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –æ–ø—Ü–∏–π —Å–æ–∑–¥–∞–Ω–∏—è

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –æ–ø—Ü–∏–π –¥–ª—è `defineStore()`, –≤—ã –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—à–∏—Ä–∏—Ç—å `DefineStoreOptionsBase`. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `PiniaCustomProperties`, –æ–Ω–∞ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–≤–∞ –¥–∂–µ–Ω–µ—Ä–∏–∫–∞: State –∏ —Ç–∏–ø Store, –ø–æ–∑–≤–æ–ª—è—è –≤–∞–º –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ç–æ, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–∞ –¥–µ–π—Å—Ç–≤–∏–π:

```ts
import 'pinia'

declare module 'pinia' {
    export interface DefineStoreOptionsBase<S, Store> {
        // –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º—Å –¥–ª—è –ª—é–±–æ–≥–æ –∏–∑ —ç–∫—à–µ–Ω–æ–≤
        debounce?: Partial<Record<keyof StoreActions<Store>, number>>
    }
}
```

:::tip
–°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–∞–∫–∂–µ —Ç–∏–ø `StoreGetters` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è _–≥–µ—Ç—Ç–µ—Ä–æ–≤_ –∏–∑ —Ç–∏–ø–∞ Store. –í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –æ–ø—Ü–∏–∏ _setup stores_ –∏–ª–∏ _option stores_ **—Ç–æ–ª—å–∫–æ**, —Ä–∞—Å—à–∏—Ä–∏–≤ —Ç–∏–ø—ã `DefineStoreOptions` –∏ `DefineSetupStoreOptions` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.
:::

## Nuxt.js

–ü—Ä–∏ [–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ pinia –≤–º–µ—Å—Ç–µ —Å Nuxt](../ssr/nuxt.md) –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—Ç—å [Nuxt plugin](https://nuxtjs.org/docs/2.x/directory-structure/plugins). –≠—Ç–æ –¥–∞—Å—Ç –≤–∞–º –¥–æ—Å—Ç—É–ø –∫ —ç–∫–∑–µ–º–ø–ª—è—Ä—É `pinia`:

```ts
// plugins/myPiniaPlugin.ts
import { PiniaPluginContext } from 'pinia'

function MyPiniaPlugin({ store }: PiniaPluginContext) {
    store.$subscribe((mutation) => {
        // —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        console.log(`[üçç ${mutation.storeId}]: ${mutation.type}.`)
    })

    // –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞–±—Ä–∞–Ω–æ, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ TS
    return { creationTime: new Date() }
}

export default defineNuxtPlugin(({ $pinia }) => {
    $pinia.use(MyPiniaPlugin)
})
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è TypeScript, –≤–∞–º –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ `PiniaPluginContext` –∏ `Plugin`, –∞ —Ç–∞–∫–∂–µ –∏—Ö –∏–º–ø–æ—Ä—Ç, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ñ–∞–π–ª `.js`.

### Nuxt.js 2

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Nuxt.js 2, —Ç–∏–ø—ã –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è:

```ts
// plugins/myPiniaPlugin.ts
import { PiniaPluginContext } from 'pinia'
import { Plugin } from '@nuxt/types'

function MyPiniaPlugin({ store }: PiniaPluginContext) {
    store.$subscribe((mutation) => {
        // —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        console.log(`[üçç ${mutation.storeId}]: ${mutation.type}.`)
    })

    // –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞–±—Ä–∞–Ω–æ, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ TS
    return { creationTime: new Date() }
}

const myPlugin: Plugin = ({ $pinia }) => {
    $pinia.use(MyPiniaPlugin)
}

export default myPlugin
```
